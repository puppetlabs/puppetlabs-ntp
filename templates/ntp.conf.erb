# ntp.conf: Managed by puppet.
#
<% if scope.lookupvar('ntp::panic') == false -%>
# Keep ntpd from panicking in the event of a large clock skew
# when a VM guest is suspended and resumed.
tinker panic 0
<% end -%>

<% if scope.lookupvar('ntp::restrict') != [] -%>
# Permit time synchronization with our time source, but do not'
# permit the source to query or modify the service on this system.'
<% scope.lookupvar('ntp::restrict').flatten.each do |restrict| -%>
<%= restrict %>
<% end %>
<% end -%>

# Servers
<% scope.lookupvar('ntp::servers').flatten.each do |server| -%>
server <%= server %><% if scope.lookupvar('ntp::preferred_servers').include?(server) -%> prefer<% end %>
<% end -%>

<% if scope.lookupvar('::is_virtual') == "false" -%>
# Undisciplined Local Clock. This is a fake driver intended for backup
# and when no outside source of synchronized time is available. 
server	127.127.1.0	# local clock
fudge	127.127.1.0 stratum 10	
<% end -%>

# Driftfile.
driftfile <%= scope.lookupvar('ntp::driftfile') %>

<% if scope.lookupvar('ntp::keys_enable') -%>
keys <%= scope.lookupvar('ntp::keys_file') %>
<% unless scope.lookupvar('ntp::keys_trusted').empty? -%>
trustedkey <%= scope.lookupvar('ntp::keys_trusted').join(' ') %>
<% end -%>
<% if scope.lookupvar('ntp::keys_requestkey') != '' -%>
requestkey <%= scope.lookupvar('ntp::keys_requestkey') %>
<% end -%>
<% if scope.lookupvar('ntp::keys_controlkey') != '' -%>
controlkey <%= scope.lookupvar('ntp::keys_controlkey') %>
<% end -%>
<% end -%>
